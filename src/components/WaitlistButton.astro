---
// src/components/WaitlistButton.astro
---

<script>
  // Desktop interactions
  const button = document.getElementById('requestAccess');
  const playground = document.getElementById('playgroundLink');
  const desktopForm = document.getElementById('desktopForm');
  const buttonContainer = document.getElementById('buttonContainer');
  const cancelLink = document.getElementById('cancelLink');
  
  const showDesktopForm = () => {
    buttonContainer?.classList.remove('gap-4');
    button?.classList.add('opacity-0', 'translate-x-[-20px]');
    playground?.classList.add('opacity-0', 'translate-x-[20px]');
    
    setTimeout(() => {
      button?.classList.add('hidden');
      playground?.classList.add('hidden');
      desktopForm?.classList.remove('hidden');
      cancelLink?.classList.remove('hidden');
      setTimeout(() => {
        desktopForm?.classList.remove('opacity-0', 'scale-95');
        cancelLink?.classList.remove('opacity-0');
      }, 50);
    }, 200);
  };

  const showButtons = () => {
    desktopForm?.classList.add('opacity-0', 'scale-95');
    cancelLink?.classList.add('opacity-0');
    
    setTimeout(() => {
      desktopForm?.classList.add('hidden');
      cancelLink?.classList.add('hidden');
      button?.classList.remove('hidden');
      playground?.classList.remove('hidden');
      
      setTimeout(() => {
        buttonContainer?.classList.add('gap-4');
        button?.classList.remove('opacity-0', 'translate-x-[-20px]');
        playground?.classList.remove('opacity-0', 'translate-x-[20px]');
      }, 50);
    }, 200);
  };

  button?.addEventListener('click', showDesktopForm);
  cancelLink?.addEventListener('click', (e) => {
    e.preventDefault();
    showButtons();
  });
</script>

<style>
  .transition-slide {
    transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>

<!-- Desktop Version (hidden on mobile) -->
<div class="relative h-[52px] hidden sm:block">
  <div id="buttonContainer" class="flex items-center justify-center gap-4 transition-[gap] duration-200">
    <button 
      id="requestAccess"
      class="bg-stone-900 text-white px-6 py-3 rounded-md text-lg hover:bg-stone-800 active:scale-[0.98] active:bg-stone-700 transition-slide"
    >
      Request Early Access
    </button>

    <a 
      id="playgroundLink" 
      href="/playground" 
      class="border border-stone-100 text-stone-900 px-6 py-3 rounded-md text-lg hover:bg-stone-50 active:scale-[0.98] active:bg-stone-100 active:border-stone-300 transition-slide"
    >
      Interactive Playground
    </a>

    <form 
      id="desktopForm" 
      class="hidden opacity-0 scale-95 flex items-center bg-white rounded-[20px] shadow-lg overflow-hidden w-[440px] transition-all duration-200 ease-out"
    >
      <input
        type="email"
        placeholder="Email"
        class="flex-1 px-6 py-3.5 text-lg text-stone-600 placeholder-stone-400 outline-none bg-stone-50/50"
      />
      <button 
        type="submit"
        class="bg-black text-white px-6 py-2.5 text-lg font-medium whitespace-nowrap mx-2 my-2 rounded-[14px] hover:opacity-90 active:scale-[0.98] transition-all duration-150"
      >
        Join waitlist
      </button>
    </form>
  </div>
  
  <a 
    href="#" 
    id="cancelLink" 
    class="hidden opacity-0 text-stone-500 hover:text-stone-700 text-sm absolute -bottom-8 left-1/2 -translate-x-1/2 transition-all duration-200"
  >
    Cancel
  </a>
</div>

<!-- Mobile Version (hidden on desktop) -->
<div class="block sm:hidden space-y-4">
  <button 
    id="mobileRequestAccess"
    class="w-full bg-stone-900 text-white px-6 py-3 rounded-md text-lg hover:bg-stone-800 active:scale-[0.98] active:bg-stone-700 transition-slide"
  >
    Request Early Access
  </button>

  <a 
    href="/playground" 
    class="block w-full border border-stone-100 text-stone-900 px-6 py-3 rounded-md text-lg text-center hover:bg-stone-50 active:scale-[0.98] active:bg-stone-100 active:border-stone-300 transition-slide"
  >
    Interactive Playground
  </a>

  <div class="fixed inset-0 bg-white/80 backdrop-blur-sm hidden" id="mobileFormOverlay">
    <div class="min-h-screen flex flex-col px-4 py-12">
      <form class="space-y-4 w-full max-w-md mx-auto">
        <input
          type="email"
          placeholder="Email"
          class="w-full px-6 py-4 text-lg text-stone-600 placeholder-stone-400 outline-none bg-white rounded-[20px] shadow-lg"
        />
        <button 
          type="submit"
          class="w-full bg-black text-white px-6 py-4 text-lg font-medium rounded-[20px] hover:opacity-90 active:scale-[0.98] transition-all duration-150"
        >
          Join waitlist
        </button>
      </form>
      <button class="mt-4 text-stone-500">Cancel</button>
    </div>
  </div>
</div>

<script>
  // Mobile interactions
  const mobileButton = document.getElementById('mobileRequestAccess');
  const mobileOverlay = document.getElementById('mobileFormOverlay');
  
  mobileButton?.addEventListener('click', () => {
    mobileOverlay?.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  });

  mobileOverlay?.addEventListener('click', (e) => {
    if (e.target === mobileOverlay) {
      mobileOverlay.classList.add('hidden');
      document.body.style.overflow = '';
    }
  });

  const mobileCancelButton = mobileOverlay?.querySelector('button[class*="mt-4"]');
  mobileCancelButton?.addEventListener('click', () => {
    mobileOverlay?.classList.add('hidden');
    document.body.style.overflow = '';
  });
</script>