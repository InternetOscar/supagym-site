---
// src/components/WaitlistButton.astro
---

<script>
  const button = document.getElementById('requestAccess');
  const playground = document.getElementById('playgroundLink');
  const form = document.getElementById('waitlistForm');
  const buttonContainer = document.getElementById('buttonContainer');
  const cancelLink = document.getElementById('cancelLink');

  const showButtons = () => {
    // Hide form first
    form?.classList.add('opacity-0', 'scale-95');
    cancelLink?.classList.add('opacity-0');

    // Wait for fade out, then switch display
    setTimeout(() => {
      form?.classList.add('hidden');
      cancelLink?.classList.add('hidden');
      button?.classList.remove('hidden');
      playground?.classList.remove('hidden');

      // Trigger fade in for buttons
      setTimeout(() => {
        buttonContainer?.classList.add('gap-4');
        button?.classList.remove('opacity-0', 'translate-x-[-20px]');
        playground?.classList.remove('opacity-0', 'translate-x-[20px]');
      }, 50);
    }, 200);
  };

  const showForm = () => {
    // Start transition
    buttonContainer?.classList.remove('gap-4');
    button?.classList.add('opacity-0', 'translate-x-[-20px]');
    playground?.classList.add('opacity-0', 'translate-x-[20px]');

    // Wait for fade out, then switch display
    setTimeout(() => {
      button?.classList.add('hidden');
      playground?.classList.add('hidden');
      form?.classList.remove('hidden');
      cancelLink?.classList.remove('hidden');
      // Trigger fade in
      setTimeout(() => {
        form?.classList.remove('opacity-0', 'scale-95');
        cancelLink?.classList.remove('opacity-0');
      }, 50);
    }, 200);

    const input = document.getElementById('emailInput');
    input?.focus();
  };

  button?.addEventListener('click', showForm);
  cancelLink?.addEventListener('click', (e) => {
    e.preventDefault();
    showButtons();
  });

  // Handle outside clicks
  document.addEventListener('click', (e) => {
    const formElement = document.getElementById('waitlistForm');
    const requestButton = document.getElementById('requestAccess');

    if (!formElement?.contains(e.target as Node) &&
        !requestButton?.contains(e.target as Node) &&
        !formElement?.classList.contains('hidden')) {
      showButtons();
    }
  });
</script>

<style>
  .transition-slide {
    transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>

<div class="relative h-[64px]">
  <div id="buttonContainer" class="flex flex-col sm:flex-row items-center justify-center gap-4 transition-[gap] duration-200">
    <button 
      id="requestAccess"
      class="w-full sm:w-auto bg-stone-900 text-white px-6 py-3 rounded-md text-lg hover:bg-stone-800 active:scale-[0.98] active:bg-stone-700 transition-slide"
    >
      Request Early Access
    </button>

    <a 
      id="playgroundLink" 
      href="/playground" 
      class="w-full sm:w-auto border border-stone-100 text-stone-900 px-6 py-3 rounded-md text-lg hover:bg-stone-50 active:scale-[0.98] active:bg-stone-100 active:border-stone-300 transition-slide text-center"
    >
      Interactive Playground
    </a>

    <form 
      id="waitlistForm" 
      class="hidden opacity-0 scale-95 flex flex-col sm:flex-row items-stretch sm:items-center bg-white rounded-[20px] shadow-lg overflow-hidden w-full max-w-[440px] mx-auto transition-all duration-200 ease-out p-2 sm:p-0"
    >
      <input
        id="emailInput"
        type="email"
        placeholder="Email"
        class="flex-1 px-4 sm:px-6 py-3 text-lg text-stone-600 placeholder-stone-400 outline-none bg-stone-50/50 rounded-[14px] sm:rounded-none"
      />
      <button 
        type="submit"
        class="bg-black text-white px-6 py-2.5 text-lg font-medium whitespace-nowrap mt-2 sm:mt-0 sm:mx-2 sm:my-2 rounded-[14px] hover:opacity-90 active:scale-[0.98] transition-all duration-150"
      >
        Join waitlist
      </button>
    </form>
  </div>
  
  <a 
    href="#" 
    id="cancelLink" 
    class="hidden opacity-0 text-stone-500 hover:text-stone-700 text-sm absolute -bottom-8 left-1/2 -translate-x-1/2 transition-all duration-200"
  >
    Cancel
  </a>
</div>
